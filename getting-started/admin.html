<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Interact with contract as an Admin - Tokei Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/prerequisites.html"><strong aria-hidden="true">1.1.</strong> Prerequisites</a></li><li class="chapter-item expanded "><a href="../getting-started/build.html"><strong aria-hidden="true">1.2.</strong> Build the contracts</a></li><li class="chapter-item expanded "><a href="../getting-started/test.html"><strong aria-hidden="true">1.3.</strong> Test the contracts</a></li><li class="chapter-item expanded "><a href="../getting-started/user.html"><strong aria-hidden="true">1.4.</strong> Interact with contract as a User</a></li><li class="chapter-item expanded "><a href="../getting-started/admin.html" class="active"><strong aria-hidden="true">1.5.</strong> Interact with contract as an Admin</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Tokei Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/starknet-io/tokei" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/starknet-io/tokei/book/src/getting-started/admin.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="starknet-admin-interaction-script"><a class="header" href="#starknet-admin-interaction-script">StarkNet Admin Interaction Script</a></h1>
<h2 id="-overview"><a class="header" href="#-overview">🔍 Overview</a></h2>
<p>The Tokei Lockup Linear Contract on StarkNet facilitates the creation and management of time-bound asset streams. This guide delves into the functionalities, fee structures, and key contract components like <code>Durations</code>, <code>Range</code>, <code>Broker</code>, and <code>LockupLinearStream</code>.
The Tokei Lockup Linear Contract offers a comprehensive solution for asset distribution on StarkNet. Its sophisticated structures enable precise control over asset streaming, making it an essential tool for DeFi applications. A deep understanding of its fee calculations and time-bound mechanisms is key for effective implementation.</p>
<h2 id="-core-functionalities"><a class="header" href="#-core-functionalities">💪 Core Functionalities</a></h2>
<h3 id="stream-creation-and-management"><a class="header" href="#stream-creation-and-management">Stream Creation and Management</a></h3>
<ul>
<li>Create asset streams with specific timings using the <code>Range</code> structure.</li>
<li>Support for cancelable and transferable streams.</li>
<li>Functions for withdrawing assets according to the stream schedule.</li>
</ul>
<h3 id="fee-handling"><a class="header" href="#fee-handling">Fee Handling</a></h3>
<ul>
<li>Management of protocol and broker fees based on the total stream amount.</li>
<li>Limitations to prevent excessive fee charges.</li>
</ul>
<h3 id="nft-integration"><a class="header" href="#nft-integration">NFT Integration</a></h3>
<ul>
<li>Representation of each asset stream as an NFT for ease of tracking and transferability.</li>
</ul>
<h2 id="-key-structures-and-functions"><a class="header" href="#-key-structures-and-functions">🔑 Key Structures and Functions</a></h2>
<h3 id="fee-calculation-check_and_calculate_fees"><a class="header" href="#fee-calculation-check_and_calculate_fees">Fee Calculation (<code>check_and_calculate_fees</code>)</a></h3>
<ul>
<li><strong>Inputs</strong>: Total stream amount, protocol fee percentage, broker fee percentage, max fee limit.</li>
<li><strong>Outputs</strong>: Calculated deposit, protocol fee, and broker fee in <code>CreateAmounts</code> struct.</li>
<li><strong>Process</strong>:
<ul>
<li>Validation of protocol and broker fees against the maximum fee limit.</li>
<li>Calculation of absolute fee amounts.</li>
<li>Verification that total amount covers both fees, with remainder as the deposit amount.</li>
</ul>
</li>
</ul>
<h3 id="percentagemath-trait"><a class="header" href="#percentagemath-trait">PercentageMath Trait</a></h3>
<ul>
<li>Utilized for calculating fee percentages as a proportion of the total amount.</li>
</ul>
<h3 id="scaled-division-scaled_down_div"><a class="header" href="#scaled-division-scaled_down_div">Scaled Division (<code>scaled_down_div</code>)</a></h3>
<ul>
<li>Function for dividing with scaling, used in time-related calculations.</li>
</ul>
<h3 id="range-and-durations"><a class="header" href="#range-and-durations">Range and Durations</a></h3>
<ul>
<li><strong>Range</strong>: Defines timestamps for the start, cliff, and end of an asset stream.</li>
<li><strong>Durations</strong>: Represents cliff and total duration in time units.</li>
</ul>
<h3 id="lockuplinearstream-structure"><a class="header" href="#lockuplinearstream-structure">LockupLinearStream Structure</a></h3>
<ul>
<li>Represents an asset stream, including financial tracking through <code>LockupAmounts</code>.</li>
<li><strong>LockupAmounts</strong>: Encapsulates deposited, withdrawn, and refunded amounts.</li>
</ul>
<h3 id="validation-checks-check_create_with_range"><a class="header" href="#validation-checks-check_create_with_range">Validation Checks (<code>check_create_with_range</code>)</a></h3>
<ul>
<li>Ensures timing integrity and deposit amount of the stream.</li>
<li>Checks for valid timing sequence and that current time precedes the end time.</li>
</ul>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<ul>
<li>Setting and retrieving protocol fees</li>
<li>Claiming protocol revenues</li>
<li>Viewing administrative details</li>
<li>Dynamic interaction with smart contracts</li>
</ul>
<h2 id="-prerequisites"><a class="header" href="#-prerequisites">🏗️ Prerequisites</a></h2>
<p>Before running this script, ensure you have the following installed:</p>
<ul>
<li>Node.js and npm</li>
<li>StarkNet libraries and ethers.js</li>
<li>TypeScript and ts-node</li>
</ul>
<h2 id="-installation"><a class="header" href="#-installation">⚙️ Installation</a></h2>
<p>To set up the script on your local machine, follow these steps:</p>
<ol>
<li>Clone the GitHub repository:</li>
<li>Navigate to the repository directory and install the required dependencies:</li>
</ol>
<pre><code class="language-bash">npm install or yarn
</code></pre>
<h2 id="-build-the-contracts"><a class="header" href="#-build-the-contracts">🛠️ Build the contracts</a></h2>
<pre><code class="language-bash">scarb build
</code></pre>
<h2 id="-usage"><a class="header" href="#-usage">🤺 Usage</a></h2>
<p>To execute the script, run the following command in the root directory of the project:</p>
<pre><code class="language-bash">npx ts-node src/scripts/admin_interaction.ts
</code></pre>
<p>Upon running the command, the script will initiate a CLI, prompting you to select from a range of functions for execution. Follow the on-screen instructions to interact with the smart contracts.</p>
<h2 id="available-functions"><a class="header" href="#available-functions">Available Functions</a></h2>
<p>The script offers various functionalities, categorized into &quot;view&quot; and &quot;write&quot; operations:</p>
<h3 id="view-functions"><a class="header" href="#view-functions">View Functions</a></h3>
<ul>
<li><code>get_admin</code></li>
<li><code>get_flash_fee</code></li>
<li><code>get_protocol_fee</code></li>
<li><code>get_protocol_revenues</code></li>
</ul>
<h3 id="write-functions"><a class="header" href="#write-functions">Write Functions</a></h3>
<ul>
<li><code>set_flash_fee</code></li>
<li><code>set_protocol_fee</code></li>
<li><code>claim_protocol_revenues</code></li>
</ul>
<h2 id="setting-protocol-fees"><a class="header" href="#setting-protocol-fees">💰Setting Protocol Fees</a></h2>
<p>As an administrator, you can adjust the protocol fees charged by Tokei. Here's how to set the protocol fee using the <strong><code>set_protocol_fee</code></strong> </p>
<ul>
<li>Enter the function name in this case : set_protocol_fee</li>
<li>You will be prompted with the protocol fee to be set, enter the amount.</li>
<li>And that's all you would have successfully set the protocol fee.</li>
</ul>
<p>Here's an example of how you can set the protocol fee :
<img width="1373" alt="Screenshot 2024-01-25 at 9 56 17 PM" src="https://github.com/Akashneelesh/tokei/assets/66639153/43de5d3a-29cb-4297-b45b-84b546262f2a"></p>
<h2 id="getting-the-protocol-fees"><a class="header" href="#getting-the-protocol-fees">Getting the Protocol Fees</a></h2>
<p>Here's an example of how you can retrieve the protocol fee 
function:<img width="1374" alt="Screenshot 2024-01-25 at 9 55 08 PM" src="https://github.com/Akashneelesh/tokei/assets/66639153/13a404c4-c700-4e47-944b-d8a63e0488ab">
For each function, you will be prompted to input the necessary parameters before execution.</p>
<h2 id="finalizing-your-admin-tasks"><a class="header" href="#finalizing-your-admin-tasks"><strong>Finalizing Your Admin Tasks</strong></a></h2>
<p>After you've set fees or claimed revenues, verify the transactions have processed successfully by checking the Starknet block explorer with the transaction hashes output by the script.</p>
<h2 id="conclusion"><a class="header" href="#conclusion"><strong>Conclusion</strong></a></h2>
<p>Administering the Tokei protocol requires a careful approach to manage fees and revenues effectively. By following the steps outlined in this guide, you can confidently execute administrative tasks, ensuring Tokei continues to operate smoothly on the Starknet platform.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../getting-started/user.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../getting-started/user.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
